{"version":3,"file":"fino-database.es.js","sources":["../src/utils/index.ts","../src/database/index.ts","../src/index.ts"],"sourcesContent":["import Database from \"../database\"\n\n// 判断是否是一个对象\nexport const isObject = (obj: unknown) => typeof(obj) === 'object' && obj !== null\n\nexport function isKeywordInThis(key: string) {\n  const instance = new Database()\n  let keys = Object.keys(instance)\n\n  return keys.includes(key)\n}\n","import { isKeywordInThis, isObject } from \"../utils\";\n\ninterface DataType {\n  [props: string]: any\n}\n\n/**\n * Provide data warehouse for fino framework\n * @param { type }  - this is a backup\n */\nclass Database {\n  // Namespace of module data\n  public namespace: string = '';\n\n  // Database\n  public data: DataType = {};\n\n  // Cache data key that has been set up proxy;\n  private existingProxy: Array<string> = [];\n\n\n  /**\n   * Initialize the namespace of the currently activated project\n   * @param { string } - name namespace\n   */\n  init(spacename: string) {\n    if(!spacename) { throw new Error('请传入命名空间'); return }\n\n    // 重置上一个命名空间的状态\n    // this.reset()\n    this.namespace = spacename\n  }\n\n  /**\n   * set up reactive data\n   * @param { object } - data 用户需要设置的数据\n   * @param { string? } - namespace 命名空间\n   */\n  set(data: DataType, namespace?: string) {\n\n    if(namespace && isKeywordInThis(namespace)) {\n      console.error(`${namespace}是数据仓库的关键字，请更改命名空间`);\n      return\n    }\n\n    if(!isObject(data)) {\n      console.error(`设置的数据必须是一个对象`);\n      return\n    }\n\n    const currentSpace: string = namespace || this.namespace;\n\n    let initialData = this.data[currentSpace] || {};\n\n    // 设置数据\n    this.data[currentSpace] = Object.assign(initialData, data, {\n      _spacename: currentSpace\n    })\n\n    // 代理访问链\n    for(let key in data) {\n      this.proxyOfprototype(data, currentSpace, key)\n    }\n\n    // 代理内容\n    this.data[currentSpace] = this.proxyOfcontent(currentSpace)\n  }\n\n  /**\n   * Get the data of a module\n   * @param { string } - key 需要获取的数据的key值\n   * @param { string } - namespace 命名空间\n   */\n  get(key?: string, namespace?: string) {\n    // 如果key为空，返回所有数据\n    if(!key && namespace) {\n      return this.data[this.namespace]\n    }\n    // 如果不传第二个参数， 默认获取当前命名空间下面的数据\n    else if(key && !namespace && this.data[this.namespace] && this.data[this.namespace][key] !== undefined) {\n      return this.data[this.namespace][key]\n    }\n    // 如果穿了第二个参数， 那么获取相应命名空间下面的数据\n    else if(namespace && key && this.data[namespace]) {\n      return this.data[namespace][key]\n    }\n  }\n\n  /**\n   * Reset the data under the current namespace\n   */\n  clear() {\n    if(!this.data[this.namespace]) { return }\n\n    const keys = Object.keys(this.data[this.namespace]);\n\n    keys.forEach(key => {\n      if(key === 'spacename') { return }\n\n      delete (this as DataType)[key]\n    })\n\n    this.data[this.namespace] = null\n  }\n\n  /**\n   * Proxy access chain\n   * @param { object } - data 用户需要设置的数据\n   * @param { string } - namespace 命名空间\n   * @param { string } - key 数据的key\n   */\n  proxyOfprototype(data: DataType, namespace: string, key: string) {\n    if(key === '_spacename') { return }\n\n    console.log(data)\n\n    const _namespace = namespace || this.namespace;\n\n    const sharePropertyDefinition = {\n\n      get: () => {\n        return this.data[_namespace][key]\n      },\n\n      set: (newvalue: unknown) => {\n        this.data[key] = newvalue\n        this.data[_namespace][key] = newvalue\n      },\n\n      enumerable: true,\n      configurable: true,\n    }\n\n    Object.defineProperty(this, key, sharePropertyDefinition)\n  }\n\n  /**\n   * Proxy data content\n   * @param { string } - namespace 命名空间\n   */\n  proxyOfcontent(namespace: string): ProxyConstructor {\n    if(this.existingProxy.includes(namespace)) {\n      return this.data[namespace]\n    }\n\n    let proxy =  new Proxy(this.data[namespace], {\n      get: (target: any, key: string | number | symbol, receiver: any) => {\n\n        const res = Reflect.get(target, key, receiver);\n\n        return res\n      },\n      set: (target: any, key: string | number | symbol, value: any, receiver: any) => {\n        const oldValue = target[key]\n        if(target._spacename !== this.namespace && target._spacename !== 'global') {\n          console.error('不允许修改其他数据仓库的数据');\n          return oldValue\n        }\n        const result = Reflect.set(target, key, value, receiver);\n\n        return result\n      }\n    })\n\n    this.existingProxy.push(namespace)\n\n    return proxy\n  }\n\n\n}\n\n\nexport default Database\n","\nimport Database from './database/index'\nconsole.log('databnase改变了最终版8')\nexport default Database\n\n"],"names":[],"mappings":"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"}